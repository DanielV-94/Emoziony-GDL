document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof gsap&&"undefined"!=typeof SplitType){const e=document.querySelector(".hero-title"),t=document.querySelector(".hero-titlee"),n=document.querySelector(".hero-subtitle"),o=document.querySelector(".hero-content .cta-button");if(e){const t=new SplitType(e,{types:"chars"}).chars;gsap.fromTo(t,{opacity:0,y:100,rotationX:-90},{opacity:1,y:0,rotationX:0,duration:1,ease:"back.out(1.7)",stagger:.03,delay:.5,repeat:-1,repeatDelay:3,yoyo:!0})}if(t){const e=new SplitType(t,{types:"chars"}).chars;gsap.fromTo(e,{opacity:0,y:100,rotationX:-90},{opacity:1,y:0,rotationX:0,duration:1,ease:"back.out(1.7)",stagger:.03,delay:.8,repeat:-1,repeatDelay:3.3,yoyo:!0})}n&&gsap.fromTo(n,{opacity:0,y:30},{opacity:1,y:0,duration:1,ease:"power2.out",delay:1.5,repeat:-1,repeatDelay:3.5,yoyo:!0}),o&&gsap.fromTo(o,{opacity:0,scale:.8},{opacity:1,scale:1,duration:.8,ease:"back.out(1.7)",delay:2,repeat:-1,repeatDelay:3.7,yoyo:!0})}const e=e=>{const t=e.querySelector("source[data-src]");t&&(t.src=t.dataset.src,t.removeAttribute("data-src"),e.load())};if("undefined"!=typeof gsap&&"undefined"!=typeof ScrollTrigger){gsap.registerPlugin(ScrollTrigger);const t=gsap.utils.toArray(".testimonial-item");t.length>0&&t.forEach(((t,n)=>{const o=t.querySelector(".testimonial-video");0===n?(t.classList.remove("testimonial-hidden"),gsap.set(t,{opacity:1,y:0}),o&&(e(o),o.play().catch((()=>{})))):(gsap.set(t,{opacity:0,y:50}),ScrollTrigger.create({trigger:t,start:"top 80%",onEnter:()=>{gsap.to(t,{opacity:1,y:0,duration:.8,ease:"power2.out"}),t.classList.remove("testimonial-hidden"),o&&(e(o),o.play().catch((()=>{})))},onLeave:()=>{o&&o.pause()},onEnterBack:()=>{gsap.to(t,{opacity:1,y:0,duration:.8}),o&&o.play().catch((()=>{}))},onLeaveBack:()=>{gsap.to(t,{opacity:0,y:50,duration:.5}),o&&o.pause()}}))}))}const t=document.querySelector(".mobile-nav-toggle"),n=document.querySelector(".nav-links");t&&n&&(t.addEventListener("click",(()=>{n.classList.toggle("active"),t.classList.toggle("active")})),n.addEventListener("click",(e=>{"A"===e.target.tagName&&(n.classList.remove("active"),t.classList.remove("active"))})));const o=document.getElementById("product-modal");if(o){const e=o.querySelector(".modal-close"),t=o.querySelector(".modal-img"),n=o.querySelector(".modal-title"),a=o.querySelector(".modal-description"),c=o.querySelector(".modal-includes"),r=o.querySelector(".modal-price"),i=document.querySelectorAll(".product-details-trigger"),s=(e,i,s,l,d)=>{if(t.src=e,n.textContent=i,a.textContent=s,d){const e=d.match(/\$?([\d,]+)\s*(MXN)?/i);e?r.innerHTML=`$${e[1]} <span class="currency">MXN</span>`:r.textContent=d}else r.textContent="";c.innerHTML="",l&&l.length>0&&l.forEach((e=>{const t=document.createElement("li");t.textContent=e,c.appendChild(t)})),o.style.display="flex",setTimeout((()=>o.style.opacity="1"),10),document.body.classList.add("modal-open")},l=()=>{o.style.opacity="0",setTimeout((()=>{o.style.display="none",document.body.classList.remove("modal-open")}),300)};i.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const n=e.closest(".product-card"),o=n.querySelector("img").src,a=n.querySelector("h3").textContent,c=n.querySelector("p").textContent,r=n.dataset.price||"",i=n.dataset.includes||"",l=i?i.split(","):[];s(o,a,c,l,r)}))})),e.addEventListener("click",l),o.addEventListener("click",(e=>{e.target===o&&l()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&"flex"===o.style.display&&l()}));const d=o.querySelector(".modal-cta");d&&d.addEventListener("click",l)}const a=document.getElementById("contact-form"),c=document.getElementById("total-amount"),r=document.getElementById("success-modal"),i={"Desayuno Premium":1278,"Brunch Especial":1704,"Tarde de Snacks":959,"Cena Rom√°ntica":2556,"Box de Frutas":746,"Kit de Vino y Quesos":1811,"Ma√±ana Infantil":1172,"Detalle Corporativo":852,"Celebraci√≥n Especial":2024};function s(){let e=0;const t=a.querySelector('[name="product_interest"]');t.value&&(e+=i[t.value]||0);return a.querySelectorAll('[name="extra"]:checked').forEach((t=>{const n=t.value.match(/\$(\d+)/);n&&(e+=parseInt(n[1]))})),c.innerHTML=`$${e.toLocaleString("es-MX")} <span class="currency-small">MXN</span>`,e}if(a){const e=a.querySelector('[name="product_interest"]'),t=a.querySelectorAll('[name="extra"]');function l(e){return`üéÅ *NUEVA COTIZACI√ìN - EMOZIONI* üéÅ\n\nüì¶ *DETALLES DEL PEDIDO:*\nüë§ Destinatario: ${e.recipientName}\nüìç Direcci√≥n: ${e.recipientAddress}\nüìÖ Fecha de entrega: ${e.deliveryDate}\n‚è∞ Hora de entrega: ${e.deliveryTime}\n\nüõçÔ∏è *PRODUCTO:*\n${e.productName}\n\n‚ú® *EXTRAS:*\n‚Ä¢ ${e.extras.length>0?e.extras.join("\n‚Ä¢ "):"Ninguno"}\n\nüìû *CONTACTO:*\nTel√©fono destinatario: ${e.recipientPhone}\nTel√©fono remitente: ${e.customerPhone}\nEmail: ${e.customerEmail}\n\nüéâ *MOTIVO:*\n${e.customerOccasion}\n\nüí¨ *MENSAJE ESPECIAL:*\n${e.message||"Sin mensaje adicional"}\n\nüí∞ *TOTAL A DEPOSITAR:*\n$${e.total.toLocaleString("es-MX")} MXN\n\n---\nEnviado desde www.emozioni.com`}e.addEventListener("change",s),t.forEach((e=>{e.addEventListener("change",s)})),a.addEventListener("submit",(async e=>{e.preventDefault();const t=new FormData(a),n=[];a.querySelectorAll('[name="extra"]:checked').forEach((e=>{n.push(e.value)}));const o=s(),c=new Date(t.get("delivery_date")).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),l=t.get("product_interest");!function(e,t){document.body.classList.add("success-modal-open"),setTimeout((()=>{!function(){m.classList.add("active");const e=m.getContext("2d");m.width=window.innerWidth,m.height=window.innerHeight;const t=500,n=["#56ABCF","#444243","#FFD700","#FF69B4","#00FF00","#FF6347"];for(let e=0;e<t;e++)y.push({x:Math.random()*m.width,y:Math.random()*m.height-m.height,r:15*Math.random()+8,d:Math.random()*t,color:n[Math.floor(Math.random()*n.length)],tilt:6*Math.random()-3,tiltAngleIncremental:.03*Math.random()+.02,tiltAngle:0});function o(){e.clearRect(0,0,m.width,m.height),y.forEach(((t,n)=>{e.beginPath(),e.lineWidth=t.r/2,e.strokeStyle=t.color,e.moveTo(t.x+t.tilt+t.r,t.y),e.lineTo(t.x+t.tilt,t.y+t.tilt+t.r),e.stroke(),t.tiltAngle+=t.tiltAngleIncremental,t.y+=Math.cos(t.d)+6+t.r/2,t.tilt=8*Math.sin(t.tiltAngle-n/3),t.y>m.height&&y.splice(n,1)})),y.length>0?u=requestAnimationFrame(o):p()}o()}()}),50);const n=r.querySelector(".modal-close"),o=n.cloneNode(!0);n.parentNode.replaceChild(o,n),o.addEventListener("click",(()=>d(e,t)));const a=n=>{n.target===r&&(d(e,t),r.removeEventListener("click",a))};r.addEventListener("click",a)}({productName:l,productPrice:i[l]||0,recipientName:t.get("recipient_name"),recipientAddress:t.get("delivery_address"),recipientPhone:t.get("recipient_phone"),customerName:t.get("sender_name")||"Cliente",customerEmail:t.get("email"),customerPhone:t.get("sender_phone"),customerOccasion:t.get("occasion"),deliveryDate:c,deliveryTime:t.get("delivery_time"),message:t.get("message")||"",extras:n,total:o},a)}))}async function d(e,t){document.body.classList.remove("success-modal-open"),setTimeout((()=>{p()}),300),await async function(e,t){try{const n="http://localhost:3000/api/quotation/send",o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if((await o.json()).success)t.reset(),s();else{const t=l(e),n=`https://wa.me/${"5213313310327"}?text=${encodeURIComponent(t)}`;confirm("Hubo un problema al enviar la cotizaci√≥n autom√°ticamente. ¬øDeseas enviarla por WhatsApp manualmente?")&&window.open(n,"_blank")}}catch(t){const n=l(e),o=`https://wa.me/${"5213313310327"}?text=${encodeURIComponent(n)}`;alert("No se pudo conectar con el servidor. Se abrir√° WhatsApp para enviar tu cotizaci√≥n manualmente."),window.open(o,"_blank")}}(e,t)}const m=document.getElementById("confetti-canvas");let u,y=[];function p(){u&&cancelAnimationFrame(u),m.classList.remove("active"),y=[]}}));